<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2566">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>// =====================</p>
<p class="p1"><span class="Apple-converted-space">  </span>//<span class="Apple-converted-space">  </span>CONFIGURATION</p>
<p class="p1"><span class="Apple-converted-space">  </span>// =====================</p>
<p class="p1"><span class="Apple-converted-space">  </span>// If plots/ is at site root (recommended for GitHub Pages), keep relative:</p>
<p class="p1"><span class="Apple-converted-space">  </span>const BASE = "plots";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Antigen lists — must match your filenames (before safe() transforms spaces → _)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const ANTIGENS = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>flavi: [</p>
<p class="p1"><span class="Apple-converted-space">      </span>"DENV1 VLP","DENV2 VLP","DENV3 VLP","DENV4 VLP",</p>
<p class="p1"><span class="Apple-converted-space">      </span>"DENV1 NS1","DENV2 NS1","DENV3 NS1","DENV4 NS1",</p>
<p class="p1"><span class="Apple-converted-space">      </span>"DENV1 EDIII","DENV2 EDIII","DENV3 EDIII","DENV4 EDIII",</p>
<p class="p1"><span class="Apple-converted-space">      </span>"ZIKV VLP","ZIKVU NS1","ZIKVSU NS1","ZIKVAS EDIII",</p>
<p class="p1"><span class="Apple-converted-space">      </span>"YFV E","YFV NS1","JEV E","JEV NS1","WNV NS1","WNV EDIII","USUV NS1"</p>
<p class="p1"><span class="Apple-converted-space">    </span>],</p>
<p class="p1"><span class="Apple-converted-space">    </span>alpha: ["CHIKV VLP","CHIKV E2","ONNV VLP","MAYV E2","MAYV NSP1"]</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Optional placeholder image</p>
<p class="p1"><span class="Apple-converted-space">  </span>const FALLBACK = "assets/missing.png";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// =====================</p>
<p class="p1"><span class="Apple-converted-space">  </span>//<span class="Apple-converted-space">  </span>RUNTIME LOGIC</p>
<p class="p1"><span class="Apple-converted-space">  </span>// =====================</p>
<p class="p1"><span class="Apple-converted-space">  </span>const els = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>family: document.getElementById('family'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>sex: document.getElementById('sex'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>site: document.getElementById('site'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>x: document.getElementById('x'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>y: document.getElementById('y'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>img: document.getElementById('plot'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>swap: document.getElementById('swap'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>copy: document.getElementById('copy'),</p>
<p class="p1"><span class="Apple-converted-space">    </span>status: document.getElementById('status')</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function populateXY() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const list = ANTIGENS[els.family.value] || [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>function setOptions(sel) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>sel.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>for (const name of list) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const opt = document.createElement('option');</p>
<p class="p1"><span class="Apple-converted-space">        </span>opt.value = name;</p>
<p class="p1"><span class="Apple-converted-space">        </span>opt.textContent = name;</p>
<p class="p1"><span class="Apple-converted-space">        </span>sel.appendChild(opt);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>setOptions(els.x);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setOptions(els.y);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (list.length &gt; 1) els.y.value = list[1];</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Build the image URL from current controls</p>
<p class="p1"><span class="Apple-converted-space">  </span>function buildUrl() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const vals = {</p>
<p class="p1"><span class="Apple-converted-space">      </span>family: els.family.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>sex: els.sex.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>site: els.site.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>x: els.x.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>y: els.y.value</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>const safe = s =&gt; s.replace(/[^A-Za-z0-9._-]+/g, '_'); // mirrors R safe()</p>
<p class="p1"><span class="Apple-converted-space">    </span>const enc<span class="Apple-converted-space">  </span>= s =&gt; encodeURIComponent(s);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const file = `${safe(vals.x)}__vs__${safe(vals.y)}.png`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>return `${BASE}/${enc(vals.family)}/${enc(vals.sex)}/${enc(vals.site)}/${enc(file)}`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function updateImg() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const url = buildUrl();</p>
<p class="p1"><span class="Apple-converted-space">    </span>els.img.src = url;</p>
<p class="p1"><span class="Apple-converted-space">    </span>els.img.alt = `${els.x.value} vs ${els.y.value} (${els.sex.value}, ${els.site.value}, ${els.family.options[els.family.selectedIndex].text})`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Shareable state in hash</p>
<p class="p1"><span class="Apple-converted-space">    </span>const state = new URLSearchParams({</p>
<p class="p1"><span class="Apple-converted-space">      </span>f: els.family.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>s: els.sex.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>t: els.site.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>x: els.x.value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>y: els.y.value</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>history.replaceState(null, '', `#${state.toString()}`);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>preloadNeighbors();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function preloadNeighbors() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const safe = s =&gt; s.replace(/[^A-Za-z0-9._-]+/g, '_');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const enc<span class="Apple-converted-space">  </span>= s =&gt; encodeURIComponent(s);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const variants = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// swapped X/Y</p>
<p class="p1"><span class="Apple-converted-space">    </span>variants.push(`${BASE}/${enc(els.family.value)}/${enc(els.sex.value)}/${enc(els.site.value)}/${enc(safe(els.y.value))}__vs__${enc(safe(els.x.value))}.png`);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// other sexes</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const altSex of ['Both','Male','Female']) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (altSex !== els.sex.value) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>variants.push(`${BASE}/${enc(els.family.value)}/${enc(altSex)}/${enc(els.site.value)}/${enc(safe(els.x.value))}__vs__${enc(safe(els.y.value))}.png`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// other sites</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const opt of Array.from(els.site.options)) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const altSite = opt.value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (altSite !== els.site.value) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>variants.push(`${BASE}/${enc(els.family.value)}/${enc(els.sex.value)}/${enc(altSite)}/${enc(safe(els.x.value))}__vs__${enc(safe(els.y.value))}.png`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const src of variants) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const img = new Image();</p>
<p class="p1"><span class="Apple-converted-space">      </span>img.decoding = 'async';</p>
<p class="p1"><span class="Apple-converted-space">      </span>img.src = src;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Error fallback if a file is missing</p>
<p class="p1"><span class="Apple-converted-space">  </span>els.img.addEventListener('error', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>els.img.removeAttribute('data-tried-alt-sex'); // no alt-sex fallback needed anymore</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (FALLBACK) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>els.img.src = FALLBACK;</p>
<p class="p1"><span class="Apple-converted-space">      </span>els.status.textContent = 'Plot not found. Showing placeholder.';</p>
<p class="p1"><span class="Apple-converted-space">      </span>els.status.classList.add('error');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Restore state from URL hash if present</p>
<p class="p1"><span class="Apple-converted-space">  </span>function restoreFromHash() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const hash = location.hash.replace(/^#/, '');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!hash) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const p = new URLSearchParams(hash);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (p.get('f')) els.family.value = p.get('f');</p>
<p class="p1"><span class="Apple-converted-space">    </span>populateXY();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (p.get('x')) els.x.value = p.get('x');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (p.get('y')) els.y.value = p.get('y');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (p.get('s')) els.sex.value = p.get('s');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (p.get('t')) els.site.value = p.get('t');</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Events</p>
<p class="p1"><span class="Apple-converted-space">  </span>els.family.addEventListener('change', () =&gt; { populateXY(); updateImg(); });</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (const id of ['sex','site','x','y']) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>els[id].addEventListener('change', updateImg);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>els.swap.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const xv = els.x.value; els.x.value = els.y.value; els.y.value = xv; updateImg();</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>els.copy.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const url = location.href;</p>
<p class="p1"><span class="Apple-converted-space">    </span>try { await navigator.clipboard.writeText(url); els.status.textContent = 'Link copied to clipboard.'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>catch { els.status.textContent = 'Copy failed. Select and copy the address bar.'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>setTimeout(() =&gt; els.status.textContent = '', 2500);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Init</p>
<p class="p1"><span class="Apple-converted-space">  </span>populateXY();</p>
<p class="p1"><span class="Apple-converted-space">  </span>restoreFromHash();</p>
<p class="p1"><span class="Apple-converted-space">  </span>updateImg();</p>
<p class="p1">&lt;/script&gt;</p>
</body>
</html>
